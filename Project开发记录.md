# 青云之志 算分小助手

> **项目状态**：已完成核心功能开发，当前版本为单页面Web应用，支持完整的算分功能和多种配色方案。

> **功能特点**：
> - 支持完整的传导链计算逻辑
> - 中国大数单位显示（万→极）
> - 多种配色方案（莫兰迪、16QwQ、布识星河、生命序章、紫鼠法翠、彩虹小小、不思议世界、十六YYDS）
> - 轮播游戏提示功能
> - 关卡目标分管理（分页展示，每页6项，支持单行/两栏布局切换）
> - 手动输入和"取消沿用/沿用上一关"功能
> - 实时数字格式显示（纯数字/科学计数法/中国大数字）
> - 超大数字支持（e+1000及以上）
> - 未来关卡预测功能
> - 关卡目标分按钮 Hover 提示成长番数（普通/天使/膨胀）
> - 统一表格样式设计
> - 主题适配的界面优化

---

## 目录
1. [项目概述](#1-项目概述)
2. [技术架构](#2-技术架构)
3. [核心功能](#3-核心功能)
4. [使用说明](#4-使用说明)
5. [部署指南](#5-部署指南)
6. [开发历史](#6-开发历史)

---

## 1. 项目概述

### 产品定位
桌面/移动自适应的 Web 应用，帮助《青云之志》玩家通过可视化方式计算关卡得分，替代繁琐的 Excel 手工计算。

### 核心价值
- 直观的界面设计，支持多种配色方案
- 自动计算传导链触发次数
- 准确处理乘方与大数运算
- 支持中国大数单位显示（万→极）
- 实时数字格式转换
- 游戏提示轮播功能

---

## 2. 技术架构

### 前端
- **HTML5 + CSS3 + JavaScript**：单页面应用
- **CSS变量**：支持动态配色方案切换
- **响应式设计**：适配桌面和移动设备

### 后端
- **Node.js + Express**：API服务器
- **decimal.js**：高精度数值计算
- **自定义算法**：中国大数单位转换

### 核心算法
```javascript
// 传导链计算公式
Total Score = Current Level Base Score × Final Multiplier × 
              Daoyin Multiplier^(Daoyin Triggers) × 
              Fuzhong Multiplier^(Fuzhong Triggers) × 
              Yueguang Multiplier^(Yueguang Triggers)
```

---

## 3. 核心功能

### 3.1 配色方案
- **莫兰迪**：经典暖色调
- **16QwQ**：蓝绿色系
- **布识星河**：绿色系
- **生命序章**：淡蓝色系
- **紫鼠法翠**：黄青色系
- **彩虹小小**：多彩系
- **不思议世界**：深色主题
- **十六YYDS**：绿色系

### 3.2 关卡配置与印章设置
- **区块化设计**：9个可折叠的配置区块，支持显示/隐藏控制
- **区块选择器**：支持显示/隐藏各个功能区块，商店刷新星币默认显示，与标题在同一行
- **关卡选择**：关卡选择（1-1 到 Ex120）、目标分数设置
- **数值设置**：最终番数、小分分值、盗印/负重/月光番数配置
- **起始关卡设置**：盗印大盗/负重前行/月光守护起始关卡（1-1 到 Ex10）
- **触发次数与王之召唤**：实际触发次数、理论最大次数、王之召唤参数（开发中）
- **数据表格**：大数字单位系统对照表、魂牌、公开牌、宝牌指示牌、商店刷新星币
- **统一表格样式**：所有表格的关键列使用统一的浅色背景和加粗字体
- **主题适配**：表格样式支持所有8种配色方案的主题适配
- **实时显示**：所有数值自动显示三种格式（纯数字/科学计数法/大数字）
- **超大数字支持**：支持e+1000及以上超大数字的准确显示和计算
- **优化布局**：触发次数区块两部分在同一行显示，数值设置区块格式显示右对齐

### 3.3 关卡目标分管理
- 分页展示（每页6项）
- 布局切换功能：支持单行布局和两栏布局
- 两栏布局：左边显示1-1/1-2/1-3，右边显示1-4/1-5/1-6
- 手动输入番数
- "取消沿用"和"沿用上一关"功能（完整按钮文字显示）
- 增长类型选择按钮
- "确认手动输入变更"功能
- 优化的分页控件布局（标题左对齐，页码右对齐）
- 优化布局：盗印、负重、月光标题只在每页最上面显示一次，无底色样式
- 推荐值精度优化：显示2位小数，提升可读性
 - 新增：配置管理（单行布局）
   - 左侧：历史配置下拉（含“删除当前配置…”）
   - 中间：点击“存储当前数据”后，显示命名输入 + “确认/取消”
   - 删除不清空当前页面数据，仅移除存档，切换后才失效
   - 顶部右侧弹出 Alert（成功/警告/失败）反馈

### 3.4 悬浮计算结果窗
- **悬浮窗模式**：独立悬浮窗，不占用主页面布局空间
- **开关控制**：页面右上角开关控制显示/隐藏
- **拖拽功能**：支持Windows风格的自由拖拽
- **边界限制**：拖拽时自动限制在页面边界内
- **窗口控制**：最小化和关闭按钮
- **实际当前总得分**
- **理论最高当前关总得分**
- **目标分对比**
- **分解显示（番数与触发次数）**
- **精度设置（2位/4位小数，按钮样式选择）**

### 3.5 未来关卡预测功能
- **智能预测**：基于当前配置预测未来关卡的通过情况
- **准确计算**：使用每关具体的番数进行精确计算
- **超大数字支持**：支持e+1000及以上超大数字的预测计算
- **结果展示**：显示最后一个能通过的关卡和第一个无法通过的关卡
- **实时更新**：根据当前触发次数和理论最大次数分别预测
- **格式优化**：预测结果支持科学计数法和中国大数字显示

### 3.6 游戏提示轮播
- 自动轮播游戏小贴士
- 鼠标悬停暂停
- 点击指示点切换
- 6条实用游戏建议

---

## 4. 使用说明

### 4.1 基本操作流程

1. **选择配色方案**
   - 点击页面顶部的配色选项
   - 配色会自动保存到本地存储

2. **配置关卡参数**
   - 选择目标关卡
   - 输入目标分数和最终番数
   - 设置当前关小分和触发次数

3. **设置印章番数**
   - 配置起始关卡（可选）
   - 输入盗印/负重/月光番数
   - 观察实时显示的数字格式

4. **管理关卡目标分**
   - 在"每页6项"区块中查看所有关卡
   - 使用布局切换按钮选择单行或两栏布局
   - 点击增长类型按钮设置增长模式
   - 使用"取消沿用"和"沿用上一关"功能管理设置
   - 手动输入自定义番数

5. **查看计算结果**
   - 点击"计算"按钮
   - 查看实际得分与理论最高得分
   - 对比目标分数，了解过关状态

6. **使用未来关卡预测**
   - 配置好当前关卡参数后
   - 点击"预测"按钮查看未来关卡通过情况
   - 查看"当前触发次数"和"理论最大次数"的预测结果
   - 了解能通过到哪一关，在哪一关会被卡住

### 4.2 高级功能

- **布局切换**：在关卡目标分区块中切换单行布局和两栏布局，提升查看效率
- **手动输入变更**：在番数输入框中输入自定义值，点击"确认手动输入变更"
- **数字格式显示**：所有数值自动显示纯数字、科学计数法、中国大数字三种格式
- **超大数字处理**：支持e+1000及以上超大数字的准确计算和显示
- **未来关卡预测**：智能预测未来关卡的通过情况，帮助制定游戏策略
- **统一表格样式**：所有数据表格使用统一的样式设计，提升视觉体验
- **主题适配**：表格样式自动适配不同的配色方案
- **配色个性化**：选择喜欢的配色方案，提升使用体验
- **游戏提示**：查看轮播的游戏小贴士，学习游戏技巧

---

## 5. 部署指南

### 5.1 本地运行

1. **克隆项目**
   ```bash
   git clone <repository-url>
   cd QYZZ_Simulator_16
   ```

2. **启动后端服务**
   ```bash
   cd backend
   npm install
   npm start
   ```
   后端服务将在 http://localhost:4001 运行

3. **打开前端页面**
   - 直接打开 `frontend/index.html`
   - 或使用本地服务器（如 Live Server）

### 5.2 生产部署

1. **后端部署**
   - 推荐使用 Render、Railway 或 Vercel
   - 设置环境变量和端口配置

2. **前端部署**
   - 可直接部署静态文件
   - 或使用 Vercel、Netlify 等平台

### 5.3 配置说明

- **API端点**：默认指向 http://localhost:4001/api/calc 和 http://localhost:4001/api/predict
- **配色存储**：使用 localStorage 保存用户选择
- **关卡数据**：硬编码在 JavaScript 中，包含1-1到Ex120的目标分数
- **预测功能**：使用后端API进行准确的未来关卡预测计算
 - **数据存储**：使用 localStorage 保存“每关番数/沿用/手动输入/增长类型”等信息
   - 历史配置：支持命名保存、选择加载、删除带确认
   - 键：`qyzz_level_data_multi_v1`（多份），兼容 `qyzz_level_data_v1`（单次快照）
   - 交互：存储需命名后“确认/取消”；删除位于下拉旁；右上角 Alert 提示

---

## 6. 开发历史

### v1.8.4 (当前版本)
- ✅ 完整的传导链计算逻辑
- ✅ 中国大数单位显示
- ✅ 8种配色方案
- ✅ 关卡目标分管理（每页6项）
- ✅ 手动输入和沿用功能
- ✅ 游戏提示轮播
- ✅ 响应式界面设计
- ✅ 区块化配置界面（9个可折叠区块）
- ✅ 区块选择器（显示/隐藏控制）
- ✅ 精度按钮样式选择（2位/4位小数）
- ✅ 优化的触发次数输入布局
- ✅ 优化的关卡目标分布局
- ✅ 优化的数值显示对齐
- ✅ 修复结果区块字体大小一致性
- ✅ 优化结果区块布局（标题左、精度中、计算右）
- ✅ 简化关卡目标分标题显示（每页一次，无底色）
- ✅ 修复推荐值精度显示（科学计数法2位小数）
- ✅ 商店刷新星币区块滚动条优化（显示12行）
- ✅ 关卡目标分标题优化（每页只显示一次）
- ✅ 统一区块间距样式（使用CSS变量保持一致）
- ✅ 悬浮计算结果窗功能
- ✅ Windows风格拖拽功能
- ✅ 页面右上角开关控制
- ✅ 悬浮窗边界限制
- ✅ 关卡目标分布局切换功能（单行/两栏布局）
- ✅ 两栏三行布局（左边1-1/1-2/1-3，右边1-4/1-5/1-6）
- ✅ 按钮文字优化（取消沿用/沿用上一关完整显示）
- ✅ 未来关卡预测功能优化
- ✅ 修复Ex79及以上关卡目标分显示问题
- ✅ 修复预测计算中重复调用问题
- ✅ 优化预测逻辑使用每关具体番数计算
- ✅ 后端API端口更新为4001
- ✅ 修复未来关卡预测中目标分显示为0的问题
- ✅ 修复formatTargetScore函数无法正确处理科学计数法格式
- ✅ 修复预测计算中calculatePrediction函数重复调用问题
- ✅ 修复后端预测API中lastValidTarget字段缺失问题
- ✅ 优化预测逻辑确保正确使用每关的番数计算得分
- ✅ 修复formatPredictionNumber函数处理超大数字的问题
- ✅ 优化预测结果显示，支持超大数字的科学计数法和中国大数字显示
- ✅ 修复预测功能中得分显示为"-"的问题
- ✅ **新增：formatPredictionNumber方法支持e+1000大小数字输入**
- ✅ **新增：修复api/predict接口中lastValidLevel等字段为null的问题**
- ✅ **新增：统一表格样式，优化魂牌/公开牌/宝牌指示牌模块边框**
- ✅ **新增：大数字单位系统对照表、商店刷新星币、魂牌模块样式统一**
- ✅ **新增：支持不同色系主题的表格样式适配**
- ✅ **新增：商店刷新星币区块默认显示**
 - ✅ **新增：关卡目标分支持“读取历史/存储当前数据”（localStorage）**
 - ✅ **样式：配置管理改为单行、分区明确；右上角弹窗式 Alert 反馈**
 - ✅ **新增：多份历史配置管理（选择/命名保存/删除+确认弹窗）**
 - ✅ **新增：关卡目标分支持多份历史配置（命名保存/选择/删除）**
 - ✅ **样式：预测结果改为紧凑“徽章+行式”布局，压缩纵向空间**
 - ✅ **样式：新增主题变量 --accent-light/--accent-hover，并为所有主题补齐**
 - ✅ **样式：统一表格关键列浅色背景与悬停样式（对照表/商店/魂牌）**
 - ✅ **样式：败北关卡关卡位使用警告色高亮（@Ex97 等）**
 - ✅ **样式：预测行顺序优化，关卡标签移动到目标分数之后**
 - ✅ **样式：未来关卡预测两卡片等高，右侧边框始终撑满**
- ✅ **新增：关卡目标分按钮 Hover 提示成长番数（普通/天使/膨胀）**
  - 盗印：普通1.3，天使1.6，膨胀1.3^2，膨胀吃卡维1.3^4
  - 负重：普通1.5，天使2，膨胀2.25
  - 月光：普通1.5，天使2，膨胀2.25
- ✅ **样式：适配“未来关卡预测”作为子组件的样式（标题/卡片/间距统一）**
- ✅ **样式：缩小并与标题对齐“更新预测”按钮，保持圆角**
- ✅ **样式：移除“选择关卡”、“未来关卡预测”标题下分割线**
 - ✅ **样式：每页6项两栏布局中间增加纵向分割线，左右加内边距**
 - ✅ **修复：数值设置中盗印/负重/月光番数格式显示不实时更新的问题**

### 已知限制
- 王之召唤功能暂未开放（显示"功能开发中"）
- 护身符图片功能未实现
- 数据持久化使用localStorage
- 关卡数据需要手动更新

### 未来计划
- 添加护身符图片支持
- 实现数据导入导出
- 增加更多游戏提示
- 优化移动端体验
- 添加用户配置保存

---

## 技术支持

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件反馈
- 参与项目讨论

---

**感谢使用青云之志算分小助手！** 🎮✨